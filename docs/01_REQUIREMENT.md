# 要求仕様書：「ソロ優美な屍骸」支援アプリ

## 概要

本アプリは、ユーザが入力した複数の短文（以下「断片」と呼ぶ）をもとに、形態素解析を介してユーザとのインタラクティブな文章生成を行うWebアプリである。  
目的は、ユーザが「断片の続きを書く」過程を通じて、偶発的な創作体験を得ること。

---

## システム全体の流れ

1. **文の登録**
   - ユーザは、複数の断片（1文にも満たない程度の文）を入力し、「箱」に追加する。
   - すべての断片はリストとして保持される。

2. **形態素解析とトークン選択**
   - アプリは、箱に入れた断片の中からランダムに1つを選ぶ。
   - その断片を形態素解析し、**最後のnトークン**または**最後のn文字**を抽出する。（以下「最後の部分」と呼ぶ）
     - 形態素解析には`kuromoji.js`などのライブラリを使用する。
     - nの値はユーザーが設定可能とする。

3. **ユーザの追記**
   - アプリは、抽出した「最後の部分」をユーザに提示する。
   - ユーザはその続きを入力する。
   - 入力が完了すると、アプリはその続きを該当断片に結合し、「断片の繋がり」を記録する。

4. **繰り返し**
   - アプリは、再び別の未完の断片をランダムに選び、同様の処理（形態素解析→最後の部分提示→ユーザ追記）を行う。
   - 各断片が「終端条件」を満たすまで繰り返す。

5. **終端条件**
   - ユーザが「。」「！」「？」のいずれかで断片を終えると、その断片は「終端」となる。
   - 繋がる一連の断片は「完成文」として扱われ、以降は出題対象から除外される。

6. **完成と出力**
   - すべての文が終端に達した時点で、アプリは全ての完成文を**ランダムな順序で並べ替え**、最終的な文章群として表示する。

---

## 詳細仕様

### 入力仕様

- 入力対象：テキストボックス（複数行対応）
- 1文ごとに区切って登録（改行または「追加」ボタンで確定）
- 登録された文は配列として保持し、IDで管理する。

### 出題仕様

- 出題対象：未完の文のみ
- 選択方法：ランダム（またはラウンドロビンでも可）
- 出題時に形態素解析を実行

### 解析仕様

- 使用ライブラリ：`kuromoji.js` などの形態素解析器
- 出力フォーマット例：
  ```json
  [
    { "surface_form": "空", "pos": "名詞" },
    { "surface_form": "を", "pos": "助詞" },
    { "surface_form": "見上げる", "pos": "動詞" }
  ]
  ```
